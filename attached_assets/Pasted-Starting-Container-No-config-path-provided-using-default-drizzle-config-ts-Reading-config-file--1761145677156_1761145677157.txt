Starting Container
No config path provided, using default 'drizzle.config.ts'
Reading config file '/app/drizzle.config.ts'
Using 'pg' driver for database querying
[⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[⣯] Pulling schema from database...
[⣟] Pulling schema from database...
[⡿] Pulling schema from database...
[⢿] Pulling schema from database...
[⣻] Pulling schema from database...
[⣽] Pulling schema from database...
[⣷] Pulling schema from database...
[✓] Pulling schema from database...
[✓] Changes applied
> rest-express@1.0.0 start
> NODE_ENV=production node dist/index.js
  ✓ use_sandbox
  ✓ enable_online_payments
Adding SMAX columns...
  ✓ merchant_provider
  ✓ merchant_account_id
  ✓ merchant_api_key
  ✓ merchant_api_pin
  ✓ merchant_name
  ✓ merchant_type
Twilio SMS service initialized
✅ All required environment variables are present
🔄 Running database migrations...
Adding USAePay columns...
  ✓ smax_enabled
  ✓ smax_api_key
  ✓ smax_pin
  ✓ smax_base_url
Adding tenants table service control columns...
  ✓ is_trial_account
  ✓ email_service_enabled
  ✓ sms_service_enabled
  ✓ portal_access_enabled
  ✓ payment_processing_enabled
Updating subscriptions table structure...
  ✓ plan_id
  ✓ approved_by
  ✓ approved_at
  ✓ setup_fee_waived
  ✓ setup_fee_paid_at
  ✓ requested_by
  ✓ No tenants needed fixing
Updating SMS campaigns table...
  ✓ folder_ids column added
  ✓ status default changed to pending_approval
📋 All tenant_settings columns: allow_settlement_requests, consumer_portal_settings, contact_email, contact_phone, created_at, custom_branding, enable_online_payments, enabled_modules, id, merchant_account_id, merchant_api_key, merchant_api_pin, merchant_name, merchant_provider, merchant_type, privacy_policy, show_documents, show_payment_plans, smax_api_key, smax_base_url, smax_enabled, smax_pin, sms_throttle_limit, tenant_id, terms_of_service, updated_at, use_sandbox
✅ Verified new columns: merchant_api_key, merchant_api_pin, smax_api_key, smax_enabled
✅ Database migrations completed successfully
2:51:33 PM [express] serving on port 8080
⏰ Scheduled tasks configured:
   - Payment processor: Daily at 2:00 AM
   - Automation processor: Every 15 minutes
  ✓ requested_at
  ✓ rejection_reason
  ✓ emails_used_this_period
  ✓ sms_used_this_period
  ✓ current_period_start
  ✓ current_period_end
Fixing trial status for tenants with active subscriptions...
Received Postmark webhook: {
  "MessageID": "1a054340-4de2-46b5-b0da-f4bf97f19f54",
  "Recipient": "tayreed1226@icloud.com",
  "DeliveredAt": "2025-10-22T14:52:13Z",
  "Details": "smtp;250 2.0.0 Ok: queued as 4D928C0014F",
  "Tag": "campaign-37ab2433-2ffb-4b37-b396-3a7f62c3b2bb",
  "ServerID": 16801401,
  "Metadata": {
    "accountNumber": "25571882",
    "campaignId": "37ab2433-2ffb-4b37-b396-3a7f62c3b2bb",
    "consumerId": "84e81402-aa91-4b25-a161-95c6f32a8796",
    "filenumber": "741151",
    "templateId": "9dcc0bc3-025f-445a-9daf-db2f5a6b5532",
    "tenantId": "bc63d182-9691-455a-b372-10dfcad9c11e"
  },
  "RecordType": "Delivery",
  "MessageStream": "outbound"
}
📧 Postmark Event Details:
  - RecordType: Delivery
  - MessageID: 1a054340-4de2-46b5-b0da-f4bf97f19f54
  - Tag: campaign-37ab2433-2ffb-4b37-b396-3a7f62c3b2bb
  - Metadata received: {
  "accountNumber": "25571882",
  "campaignId": "37ab2433-2ffb-4b37-b396-3a7f62c3b2bb",
  "consumerId": "84e81402-aa91-4b25-a161-95c6f32a8796",
  "filenumber": "741151",
  "templateId": "9dcc0bc3-025f-445a-9daf-db2f5a6b5532",
  "tenantId": "bc63d182-9691-455a-b372-10dfcad9c11e"
}
  - Extracted campaignId: 37ab2433-2ffb-4b37-b396-3a7f62c3b2bb
  - Extracted tenantId: bc63d182-9691-455a-b372-10dfcad9c11e
Email tracking event: {
  messageId: '1a054340-4de2-46b5-b0da-f4bf97f19f54',
  recipient: 'tayreed1226@icloud.com',
  campaignId: '37ab2433-2ffb-4b37-b396-3a7f62c3b2bb',
  eventType: 'Delivery',
  timestamp: 2025-10-22T14:52:22.741Z,
  metadata: {
    accountNumber: '25571882',
    campaignId: '37ab2433-2ffb-4b37-b396-3a7f62c3b2bb',
    consumerId: '84e81402-aa91-4b25-a161-95c6f32a8796',
    filenumber: '741151',
    templateId: '9dcc0bc3-025f-445a-9daf-db2f5a6b5532',
    tenantId: 'bc63d182-9691-455a-b372-10dfcad9c11e'